#flashcards
Data: 2023-08-04 14:10
Title: [[Thread.interrupt()]]
Alias:
Header:

Что такое [[Thread.interrupt()]]?::[[Thread.interrupt()]] – это метод для корректной остановки потока. Он выставляет некоторый внутренний флаг-статус прерывания.
<!--SR:!2023-11-03,10,710-->


Body:

Как проверить состояние флага прерывания у метода `interrupt()`?
!---
Ответ:
	- Состояние этого флага можно проверить с помощью метода `isInterrupted()` или `Thread.interrupted()` (для текущего потока).
<!--SR:!2023-11-03,10,463-->


Способен ли метод `interrupt()` изменить состояние потока?
!---
Ответ:
	- Метод `interrupt()` также способен вывести поток из состояния ожидания или спячки. Т.е. если у потока были вызваны методы `sleep()` или `wait()` – текущее состояние прервется и будет выброшено исключение `InterruptedException`. Флаг в этом случае не выставляется.
<!--SR:!2023-11-03,10,423-->


Назовите примеры реализации метода `interrupt()` – I способ.
!---
Ответ:
	- Реализовать поток.
	- В потоке периодически проводить проверку статуса прерывания через вызов `isInterrupted()`.
	- Если состояние флага изменилось или было выброшено исключение во время ожидания/спячки, следовательно поток пытаются остановить извне.
	- Принять решение – продолжить работу (если по каким-то причинам остановиться невозможно) или освободить заблокированные потоком ресурсы и закончить выполнение.
	- Возможная проблема, которая присутствует в этом подходе – блокировки на потоковом вводе-выводе. Если поток заблокирован на чтении данных - вызов `interrupt()` из этого состояния его не выведет. Решения тут различаются в зависимости от типа источника данных. Если чтение идет из файла – долговременная блокировка крайне маловероятна и тогда можно просто дождаться выхода из метода `read()`. Если же чтение каким-то образом связано с сетью – стоит использовать неблокирующий ввод-вывод из Java NIO.
<!--SR:!2023-11-03,10,343-->



Назовите примеры реализации метода `interrupt()` – II способ.
!---
Ответ:
	- Сделать собственный аналог `interrupt()`. Т.е. объявить в классе потока флаги – на остановку и/или приостановку и выставлять их путем вызова заранее определённых методов извне. Методика действия при этом остаётся прежней – проверять установку флагов и принимать решения при их изменении. 
	- 
	- Недостатки такого подхода: 
	- Во-первых, потоки в состоянии ожидания таким способом не «оживить». 
	- Во-вторых, выставление флага одним потоком совсем не означает, что второй поток тут же его увидит. 
	- Для увеличения производительности виртуальная машина использует кеш данных потока, в результате чего обновление переменной у второго потока может произойти через неопределенный промежуток времени (хотя допустимым решением будет объявить переменную-флаг как `volatile`).
<!--SR:!2023-11-03,10,303-->


Главы:
- [[Различия между interrupted() и isInterrupted()]]


Sources:
- [ ] [Вопросы для собеседования на Java Developer](https://github.com/enhorse/java-interview/blob/master/README.md#%D0%9E%D0%9E%D0%9F)
- [ ] []()
- [ ] []()
